<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Blindtest Host</title>
</head>
<body>
<h1>Host Blindtest</h1>
<audio id="audio" controls></audio>
<div id="messageStop"></div>
<div id="chrono">00:00</div>
<button id="resumeBtn">Reprendre la musique</button>
<button id="nextBtn">Round suivant</button>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = { apiKey:"AIzaSyBaWatcA83qeeStPCwwq4HMOQ6UwGqBWIc", authDomain:"madmax2-20cb7.firebaseapp.com", projectId:"madmax2-20cb7" };
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const audio = document.getElementById("audio");
const messageStop = document.getElementById("messageStop");
const chrono = document.getElementById("chrono");
const resumeBtn = document.getElementById("resumeBtn");
const nextBtn = document.getElementById("nextBtn");

let playlist = ["dont-dont-go-wasting-your-emotion-mmv.mp3","musique2.mp3"];
let currentRound = 0;
let roundStartTime = null;
let intervalTimer = null;

// Démarrer round
function startRound(musicFile) {
    audio.src = musicFile;
    audio.play();
    roundStartTime = Date.now();
    startChrono();
    messageStop.textContent = "";
}

// Chrono simple
function startChrono() {
    clearInterval(intervalTimer);
    intervalTimer = setInterval(() => {
        let sec = Math.floor((Date.now() - roundStartTime)/1000);
        let min = Math.floor(sec/60);
        sec = sec % 60;
        chrono.textContent = (min<10?"0":"")+min+":"+(sec<10?"0":"")+sec;
    },1000);
}

// Écoute Stop
db.collection("control").doc("stop").onSnapshot(doc => {
    if(doc.exists && doc.data().stop) {
        audio.pause();
        messageStop.textContent = doc.data().player + " a appuyé sur Stop !";
        db.collection("control").doc("stop").set({stop:false});
    }
});

resumeBtn.addEventListener("click", () => { audio.play(); });

nextBtn.addEventListener("click", () => {
    currentRound = (currentRound+1) % playlist.length;
    startRound(playlist[currentRound]);
});

// Pour tester, démarrer le premier round automatiquement
startRound(playlist[currentRound]);
</script>
</body>
</html>
